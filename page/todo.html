<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="view-todo">
	<template>
		<style>
			:host { display: block; position: absolute; left: calc(12% + 0.7em); top: 0; right: 0; margin-bottom: 1.2em; }
			
			label { display: block; }
			
			input, textarea, select { width: 100%; box-sizing: border-box; padding: 0.3em 0.2em; border: 2px solid #00a99d; }
			.input-row { margin: 1em 0; }
			
			#wrapper { overflow: hidden; background: #fafafa; border: 2px solid #00a99d; transition: 0.5s height; }
			#wrapper.collapse { height: 0px!important; }
			
			#theform { margin: 0.4em; }
		</style>
		<div id="wrapper">
			<form id="theform" on-submit="{{preventSubmit}}">
				<div class="input-row">
					<label>Caption</label>
					<input type="text" value="{{item.caption}}" placeholder="Caption">
				</div>
				<div class="input-row">
					<label>Description</label>
					<textarea rows="2" placeholder="Description" value="{{item.description}}"></textarea>
				</div>
				<div class="input-row">
					<label>Notes</label>
					<textarea rows="5" placeholder="Notes" value="{{item.notes}}"></textarea>
				</div>
				<div class="input-row">
					<label>Deadline</label>
					<input type="date" value="{{item.deadline}}" placeholder="Deadline">
				</div>
				<div class="input-row">
					<label>Hour budget</label>
					<input type="number" value="{{item.estimateHours}}" placeholder="Hour budget">
				</div>
				<div class="input-row">
					<label>Repeat</label>
					<select value="{{item.repeat}}">
						<option value=0>No repeat</option>
						<option value=1>Every day</option>
						<option value=2>Every second day</option>
						<option value=4>Twice a week</option>
						<option value=7>Once a week</option>
						<option value=14>Every second week</option>
						<option value=31>Monthly</option>
					</select>
				</div>
				<div>
					<add-new-task text="{{item._id ? 'Save task' : 'Add new task +'}}" on-tap="{{saveItem}}"></add-new-task>
				</div>
			</form>
		</div>
	</template>
	<script>
		(function(app) {
			
			Polymer({
				
				publish: {
					item: null
				},
								
				created: function() {
					var self = this;
					
					this.item = new window.TodAi.Todo();
				},
				
				domReady: function() {
					var self = this;
					this.$.wrapper.style.height = this.$.wrapper.offsetHeight + "px";
					this.$.wrapper.classList.add("collapse");
					setTimeout(function() {
						self.$.wrapper.classList.remove("collapse");
					}, 100);
				},
				
				preventSubmit: function(evt) {
					evt.preventDefault();
				},
				
				saveItem: function() {
					window.TodAi.db.todo.save(this.item, function(err, resp) {
						if (err) {
							return;
						}
						console.log(resp);
						app.route.open("/");
					});
				}
				
			});
			
		})(window.TodAi);
	</script>
</polymer-element>
